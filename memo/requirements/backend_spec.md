# バックエンド API 仕様書

## tl;dr (要約)

このドキュメントは、フロントエンドの要件を満たすためにバックエンドで実装が必要な API 仕様を定義します。
各エンドポイントのリクエスト、成功レスポンス、主要なエラーレスポンスの概要は以下の表の通りです。

| カテゴリ       | エンドポイント                 | 説明               | 認証   | リクエストボディ  | 成功レスポンス      | 主なエラー         |
| :------------- | :----------------------------- | :----------------- | :----- | :---------------- | :------------------ | :----------------- |
| **認証**       | `POST /auth/signin`            | ユーザーログイン   | 不要   | email, password   | 200: ユーザー情報   | 401, 422           |
|                | `POST /auth/admin/signin`      | 管理者ログイン     | 不要   | email, password   | 200: ユーザー情報   | 401, 422           |
|                | `POST /auth/signout`           | ログアウト         | 必要   | なし              | 200: OK             | 401                |
| **商品**       | `GET /items`                   | 商品一覧取得       | 不要   | なし              | 200: 商品一覧       | -                  |
|                | `POST /items`                  | 商品作成           | 管理者 | name, price, etc. | 201: 作成された商品 | 401, 403, 422      |
|                | `GET /items/{itemId}`          | 商品詳細取得       | 不要   | なし              | 200: 商品情報       | 404                |
|                | `PUT /items/{itemId}`          | 商品更新           | 管理者 | name, price, etc. | 200: 更新された商品 | 401, 403, 404, 422 |
|                | `DELETE /items/{itemId}`       | 商品削除           | 管理者 | なし              | 204: No Content     | 401, 403, 404      |
| **カート**     | `GET /carts`                   | カート情報取得     | 必要   | なし              | 200: カート情報     | 401                |
|                | `POST /carts`                  | カートに商品追加   | 必要   | itemId, quantity  | 200: カート情報     | 401, 404, 422      |
|                | `DELETE /carts/items/{itemId}` | カートから商品削除 | 必要   | なし              | 200: カート情報     | 401, 404           |
| **マイページ** | `GET /my/user`                 | ユーザー情報取得   | 必要   | なし              | 200: ユーザー情報   | 401                |

---

## 1. 概要

本ドキュメントは、研修課題プロジェクトのフロントエンド要件に基づき、バックエンドで必要となる API の仕様を定義するものです。

## 2. プロジェクト構成

- `api/`: Laravel によるバックエンドアプリケーション（参考実装）
- `config/`: Docker 関連の設定ファイル（DB、Swagger など）
- `docs/`: OpenAPI による API ドキュメント

## 3. 共通仕様

### 3.1 エラーレスポンス

| ステータスコード            | 説明                                                                            | レスポンスボディ例                                                                                      |
| :-------------------------- | :------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------ |
| `401 Unauthorized`          | 認証エラー。ログインしていない状態で認証が必要な API にアクセスした場合に返却。 | `{ "message": "Unauthorized" }`                                                                         |
| `403 Forbidden`             | 権限エラー。管理権限が必要な API に一般ユーザーがアクセスした場合などに返却。   | `{ "message": "Forbidden" }`                                                                            |
| `404 Not Found`             | リソースが見つからない。存在しない ID を指定した場合などに返却。                | `{ "message": "Not Found" }`                                                                            |
| `422 Unprocessable Entity`  | バリデーションエラー。リクエストのパラメータが不正な場合に返却。                | `{ "message": "The given data was invalid.", "errors": { "email": ["The email field is required."] } }` |
| `500 Internal Server Error` | サーバー内部エラー。予期せぬエラーが発生した場合に返却。                        | `{ "message": "Internal Server Error" }`                                                                |

---

## 4. API エンドポイント詳細

### 4.1 ユーザー認証

#### 4.1.1 `POST /auth/signin` (ユーザーログイン)

- **説明:** メールアドレスとパスワードでログインし、セッションを開始する。
- **リクエストボディ:**
  | フィールド | 型 | 説明 | バリデーション |
  | :--- | :--- | :--- | :--- |
  | `email` | string | メールアドレス | 必須, email 形式 |
  | `password`| string | パスワード | 必須 |
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "id": 1,
      "name": "Taro Yamada",
      "email": "user@example.com"
    }
    ```
  - **`401 Unauthorized`**: 認証情報が不正な場合。
  - **`422 Unprocessable Entity`**: バリデーションエラー。

#### 4.1.2 `POST /auth/admin/signin` (管理者ログイン)

- **説明:** 管理者用のメールアドレスとパスワードでログインし、セッションを開始する。
- **リクエストボディ:**
  | フィールド | 型 | 説明 | バリデーション |
  | :--- | :--- | :--- | :--- |
  | `email` | string | メールアドレス | 必須, email 形式 |
  | `password`| string | パスワード | 必須 |
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "id": 1,
      "name": "Admin User",
      "email": "admin@example.com"
    }
    ```
  - **`401 Unauthorized`**: 認証情報が不正な場合。
  - **`422 Unprocessable Entity`**: バリデーションエラー。

#### 4.1.3 `POST /auth/signout` (ログアウト)

- **説明:** ログアウトし、セッションを破棄する。
- **認証:** 必要
- **レスポンス:**
  - **`200 OK`**: 成功
  - **`401 Unauthorized`**: 認証されていない場合。

### 4.2 商品管理

#### 4.2.1 `GET /items` (商品一覧取得)

- **説明:** 登録されている商品を一覧で取得する。
- **クエリパラメータ:**
  | フィールド | 型 | 説明 |
  | :--- | :--- | :--- |
  | `page` | integer | ページ番号 |
  | `limit` | integer | 1 ページあたりの表示件数 |
  | `name_like`| string | 商品名（部分一致） |
  | `price_gte`| integer | 価格（以上） |
  | `price_lte`| integer | 価格（以下） |
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "items": [
        {
          "id": 1,
          "name": "商品A",
          "price": 1000,
          "description": "商品説明",
          "image_url": "http://example.com/image.jpg"
        }
      ],
      "pagination": {
        "total": 1,
        "limit": 20,
        "offset": 0
      }
    }
    ```

#### 4.2.2 `POST /items` (商品登録)

- **説明:** 新しい商品を登録する。
- **認証:** 管理者のみ
- **リクエストボディ:**
  | フィールド | 型 | 説明 | バリデーション |
  | :--- | :--- | :--- | :--- |
  | `name` | string | 商品名 | 必須 |
  | `price` | integer | 価格 | 必須, 数値 |
  | `description`| string | 商品説明 | 必須 |
  | `image_url` | string | 商品画像 URL | 必須, URL 形式 |
- **レスポンス:**
  - **`201 Created`**: 成功
    ```json
    {
      "id": 2,
      "name": "商品B",
      "price": 2000,
      "description": "新商品説明",
      "image_url": "http://example.com/image_b.jpg"
    }
    ```
  - **`401 Unauthorized`**: 認証されていない場合。
  - **`403 Forbidden`**: 管理者権限がない場合。
  - **`422 Unprocessable Entity`**: バリデーションエラー。

#### 4.2.3 `GET /items/{itemId}` (商品詳細取得)

- **説明:** 指定した ID の商品情報を取得する。
- **パスパラメータ:**
  | フィールド | 型 | 説明 |
  | :--- | :--- | :--- |
  | `itemId` | integer | 商品 ID |
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "id": 1,
      "name": "商品A",
      "price": 1000,
      "description": "商品説明",
      "image_url": "http://example.com/image.jpg"
    }
    ```
  - **`404 Not Found`**: 商品が存在しない場合。

#### 4.2.4 `PUT /items/{itemId}` (商品更新)

- **説明:** 指定した ID の商品情報を更新する。
- **認証:** 管理者のみ
- **パスパラメータ:**
  | フィールド | 型 | 説明 |
  | :--- | :--- | :--- |
  | `itemId` | integer | 商品 ID |
- **リクエストボディ:**
  | フィールド | 型 | 説明 | バリデーション |
  | :--- | :--- | :--- | :--- |
  | `name` | string | 商品名 | 必須 |
  | `price` | integer | 価格 | 必須, 数値 |
  | `description`| string | 商品説明 | 必須 |
  | `image_url` | string | 商品画像 URL | 必須, URL 形式 |
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "id": 1,
      "name": "商品A-改",
      "price": 1200,
      "description": "商品説明（更新）",
      "image_url": "http://example.com/image_a_rev.jpg"
    }
    ```
  - **`401 Unauthorized`**: 認証されていない場合。
  - **`403 Forbidden`**: 管理者権限がない場合。
  - **`404 Not Found`**: 商品が存在しない場合。
  - **`422 Unprocessable Entity`**: バリデーションエラー。

#### 4.2.5 `DELETE /items/{itemId}` (商品削除)

- **説明:** 指定した ID の商品を削除する。
- **認証:** 管理者のみ
- **パスパラメータ:**
  | フィールド | 型 | 説明 |
  | :--- | :--- | :--- |
  | `itemId` | integer | 商品 ID |
- **レスポンス:**
  - **`204 No Content`**: 成功
  - **`401 Unauthorized`**: 認証されていない場合。
  - **`403 Forbidden`**: 管理者権限がない場合。
  - **`404 Not Found`**: 商品が存在しない場合。

### 4.3 カート管理

#### 4.3.1 `GET /carts` (カート情報取得)

- **説明:** ログインユーザーのカートに入っている商品の一覧を取得する。
- **認証:** 必要
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "items": [
        {
          "id": 1,
          "item": {
            "id": 101,
            "name": "商品A",
            "price": 1000,
            "image_url": "http://example.com/image_a.jpg"
          },
          "quantity": 2
        }
      ],
      "total_price": 2000,
      "total_quantity": 2
    }
    ```
  - **`401 Unauthorized`**: 認証されていない場合。

#### 4.3.2 `POST /carts` (カートに商品を追加)

- **説明:** カートに商品を追加する。
- **認証:** 必要
- **リクエストボディ:**
  | フィールド | 型 | 説明 | バリデーション |
  | :--- | :--- | :--- | :--- |
  | `itemId` | integer | 商品 ID | 必須, 存在する ID |
  | `quantity`| integer | 数量 | 必須, 1 以上 |
- **レスポンス:**
  - **`200 OK`**: 成功 (更新後のカート情報を返す)
  - **`401 Unauthorized`**: 認証されていない場合。
  - **`404 Not Found`**: 商品が存在しない場合。
  - **`422 Unprocessable Entity`**: バリデーションエラー。

#### 4.3.3 `DELETE /carts/items/{itemId}` (カートの商品を削除)

- **説明:** カートから指定した商品を削除する。
- **認証:** 必要
- **パスパラメータ:**
  | フィールド | 型 | 説明 |
  | :--- | :--- | :--- |
  | `itemId` | integer | 商品 ID |
- **レスポンス:**
  - **`200 OK`**: 成功 (更新後のカート情報を返す)
  - **`401 Unauthorized`**: 認証されていない場合。
  - **`404 Not Found`**: カートに商品が存在しない場合。

### 4.4 マイページ

#### 4.4.1 `GET /my/user` (ユーザー情報取得)

- **説明:** ログインしているユーザーの情報を取得する。
- **認証:** 必要
- **レスポンス:**
  - **`200 OK`**: 成功
    ```json
    {
      "id": 1,
      "name": "Taro Yamada",
      "email": "user@example.com"
    }
    ```
  - **`401 Unauthorized`**: 認証されていない場合。
